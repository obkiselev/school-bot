# PROGRESS — School Helper

## Текущая версия: 0.1.3

## Статус: Готова к тестированию

---

## Завершённые задачи (v0.1.3)

| # | Задача | Статус |
|---|--------|--------|
| 22 | Ограничение доступа: миграция БД (role, is_blocked), ADMIN_ID | ✅ Готово |
| 23 | Ограничение доступа: middleware проверки на каждое действие | ✅ Готово |
| 24 | Ограничение доступа: команды /allow, /block, /users | ✅ Готово |

---

## Завершённые задачи (v0.1.2)

| # | Задача | Статус |
|---|--------|--------|
| 20 | Кнопка "Начать заново" в главном меню | ✅ Готово |
| 21 | Баг: испанский тест генерировался на английском | ✅ Исправлено |

---

## Завершённые задачи (v0.1.1)

| # | Задача | Статус |
|---|--------|--------|
| 18 | Уникальные вопросы внутри теста (разнообразие) | ✅ Готово |
| 19 | Уникальные вопросы между тестами (дедупликация через историю) | ✅ Готово |

---

## Завершённые задачи (v0.1.0)

| # | Задача | Статус |
|---|--------|--------|
| 1 | Структура проекта (каталоги, конфиг, зависимости) | ✅ Готово |
| 2 | Главное меню (/start, навигация) | ✅ Готово |
| 3 | FSM-состояния для пути теста | ✅ Готово |
| 4 | Выбор языка (English / Spanish) | ✅ Готово |
| 5 | Выбор темы (5 тем + "Другое") | ✅ Готово |
| 6 | Выбор количества вопросов (5/10/15/20) | ✅ Готово |
| 7 | Интеграция с LLM через LM Studio | ✅ Готово |
| 8 | Промпты для генерации тестов | ✅ Готово |
| 9 | Парсер JSON-ответов LLM | ✅ Готово |
| 10 | 4 типа заданий (multiple_choice, fill_blank, translation, true_false) | ✅ Готово |
| 11 | Проверка ответов с нормализацией | ✅ Готово |
| 12 | Обратная связь (объяснение ошибок на русском) | ✅ Готово |
| 13 | Итоги теста с оценкой | ✅ Готово |
| 14 | SQLite база данных | ✅ Готово |
| 15 | Сохранение и просмотр истории | ✅ Готово |
| 16 | Выявление слабых тем | ✅ Готово |
| 17 | Отмена теста | ✅ Готово |

---

## Планы на будущие версии

- [ ] Аудирование (прослушать и ответить)
- [ ] Задания типа "Соответствие" (matching)
- [x] Ограничение доступа (только определённые пользователи) — v0.1.3
- [ ] Экспорт статистики

---

## Известные баги

_Пока не обнаружены._

---

## Журнал изменений (Changelog)

### v0.1.3 — 2026-02-27
- Ограничение доступа: только пользователи из белого списка могут пользоваться ботом
- Middleware проверки доступа на каждое сообщение и нажатие кнопки
- Роли: admin и student. Главный админ задаётся через ADMIN_ID в .env
- Команды /allow, /block, /users для управления пользователями
- Мягкая блокировка: текущий тест можно докончить, новый начать нельзя
- Защита: главного админа нельзя заблокировать, нельзя заблокировать себя
- Миграция БД автоматическая и безопасная при повторных запусках

### v0.1.2 — 2026-02-26
- Кнопка "Начать заново" в главном меню для перезапуска бота
- Исправлен баг: тесты по испанскому генерировались на английском (примеры в промпте теперь зависят от языка)
- Добавлено явное правило в промпте: вопросы должны быть на выбранном языке

### v0.1.1 — 2026-02-26
- Вопросы больше не повторяются между тестами — бот запоминает последние 50 вопросов ученика по каждой теме и передаёт их в промпт как "запрещённый список"
- Внутри одного теста — добавлено правило максимального разнообразия (разные типы вопросов, разные слова и конструкции)
- Новая функция `get_recent_questions()` в базе данных
- Обновлены: `prompts.py`, `test_generator.py`, `queries.py`, `settings.py`

### v0.1.0 — 2026-02-26
- Первая рабочая версия
- Телеграм-бот с полным циклом тестирования
- 4 типа заданий: выбор ответа, вставить слово, перевод, верно/неверно
- Интеграция с LLM (LM Studio, Qwen2.5-7B-Instruct)
- SQLite для хранения результатов
- История тестов и выявление слабых тем
