# Инструкции для Claude в рамках проекта School Bot

## 1. Перед началом любой работы обязательно прочитай актуальное состояние проекта:
- Открой файл `PROGRESS.md` и проверь/обнови текущий прогресс по задачам и фазам.
- Ориентируйся на текущую фазу разработки при выполнении задач.
- Не пушить на GIT.

## 2. Перед завершением любой сессии обязательно обнови:
- Текущую версию проекта определяй по `PROGRESS.md`
- Увеличивай последнюю цифру: 0.1.0 -> 0.1.1 -> ... -> 0.1.9 -> 0.2.0 -> 0.2.1 -> ... -> 0.2.9 -> 0.3.0. Никаких двузначных номеров — 0.1.10 не существует, после 0.1.9 всегда идёт 0.2.0.
- Обнови файлы:
  - `PROGRESS.md` — перенести завершённые задачи из "в планах" в завершённые, обновить changelog.
  - `README.md` — обновить номер версии, добавить новый функционал и прогресс по фазам разработки.
  - `requirements.txt` - обновить список пакетов
  - Другие файлы, в которых указана текущая версия.
- Git-операции:
  - `git add PROGRESS.md README.md` (и другие изменённые файлы)
  - `git commit -m "vX.Y.Z: краткое описание изменений"`
  - `git tag vX.Y.Z`
  - `git push origin main --tags`

В результате проект постоянно имеет актуальную документацию и удобную историю для отслеживания прогресса. Обновление/дополнение инструкций должно происходить через явное согласование.

## 3. "Зафиксируй промежуточные результаты"

Когда пользователь говорит зафиксировать промежуточные результаты:

- Задеплоить на сервере автоматически все изменения в проекте
- Обновить файл `PROGRESS.md` — добавить/обновить текущий прогресс по задачам в работе
- Обновить файл `CLAUDE.md` — добавить/обновить инструкции
- Обновить файл `requirements.txt` (при его наличии) — добавить/обновить список пакетов
- другие файлы, в которых ведется история изменений
- На GIT пушить НЕ надо.

## 4. "Зафиксируй текущую версию" (релиз)

Когда пользователь просит зафиксировать версию:

1. Определить текущую версию из `PROGRESS.md`
2. Определить следующую версию (инкремент minor: 0.1.9 → 0.2.0, или по указанию пользователя)
3. Обновить файлы:
   - `PROGRESS.md` — перенести текущие задачи из "в работе" в завершённые, обновить changelog
   - `README.md` — обновить номер версии, добавить новые возможности в описание
   - `requirements.txt` — обновить список пакетов
   - другие файлы, в которых ведется история изменений
4. Git-операции:
   - `git add PROGRESS.md README.md requirements.txt` (и другие изменённые файлы)
   - `git commit -m "vX.Y.Z: краткое описание изменений"`
   - `git tag vX.Y.Z`
   - `git push origin main --tags`

## О проекте

- **Название**: School Bot — Telegram-бот для МЭШ
- **Язык**: Python 3.9+
- **Фреймворк**: aiogram 3.25 (асинхронный)
- **БД**: SQLite через aiosqlite
- **Конфигурация**: pydantic-settings + .env
- **Шифрование**: cryptography (Fernet)

## Структура проекта

```
school_bot/
├── bot.py              # Точка входа
├── config.py           # Настройки (pydantic-settings)
├── core/               # database.py, encryption.py
├── mesh_api/           # auth.py, client.py, endpoints.py, models.py, exceptions.py
├── handlers/           # start.py, registration.py, schedule.py
├── keyboards/          # Клавиатуры (в планах)
├── states/             # FSM states (registration.py)
├── database/           # crud.py, migrations/init.sql
├── notifications/      # Уведомления (в планах)
├── utils/              # token_manager.py
├── tests/              # test_schedule.py, conftest.py
└── data/               # SQLite БД, логи
```

## Важные детали

- Пароли МЭШ хранятся зашифрованными (Fernet), ключ в .env
- FSM используется для пошаговой регистрации
- МЭШ API неофициальное — может сломаться
- Rate limit: не более 30 запросов/мин к МЭШ API
